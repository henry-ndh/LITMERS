{
	"info": {
		"_postman_id": "forgot-password-api-collection",
		"name": "Forgot Password API",
		"description": "API endpoints for Password Recovery/Reset (FR-003)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:5000",
			"type": "string"
		},
		{
			"key": "reset_token",
			"value": "",
			"type": "string",
			"description": "Token từ email hoặc database sau khi gửi forgot-password"
		},
		{
			"key": "test_email",
			"value": "test@example.com",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "1. Forgot Password - Gửi email reset",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// Lưu ý: Token sẽ được gửi qua email",
							"// Để test, bạn cần lấy token từ database:",
							"// SELECT token FROM password_reset_tokens WHERE user_id = (SELECT id FROM users WHERE email = 'test@example.com') ORDER BY created_at DESC LIMIT 1;",
							"",
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has success message\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.message).to.include(\"password reset link\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"email\": \"{{test_email}}\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseUrl}}/api/auth/forgot-password",
					"host": ["{{baseUrl}}"],
					"path": ["api", "auth", "forgot-password"]
				},
				"description": "Gửi yêu cầu reset password. Token sẽ được gửi qua email.\n\n**Lưu ý:**\n- API luôn trả về success message (bảo mật)\n- Token có hiệu lực 1 giờ\n- Google OAuth users không thể reset password"
			},
			"response": []
		},
		{
			"name": "2. Reset Password - Đặt lại mật khẩu",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Password reset successful\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData.success).to.be.true;",
							"    pm.expect(jsonData.message).to.include(\"Password has been reset successfully\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"token\": \"{{reset_token}}\",\n  \"newPassword\": \"newpassword123\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseUrl}}/api/auth/reset-password",
					"host": ["{{baseUrl}}"],
					"path": ["api", "auth", "reset-password"]
				},
				"description": "Đặt lại mật khẩu với token từ email.\n\n**Yêu cầu:**\n- Token phải hợp lệ và chưa hết hạn\n- Token chưa được sử dụng\n- Mật khẩu mới tối thiểu 6 ký tự"
			},
			"response": []
		},
		{
			"name": "3. Test Case - Email không tồn tại",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"email\": \"notexist@example.com\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseUrl}}/api/auth/forgot-password",
					"host": ["{{baseUrl}}"],
					"path": ["api", "auth", "forgot-password"]
				},
				"description": "Test case: Email không tồn tại trong hệ thống.\n\n**Expected:** Vẫn trả về success message (bảo mật)"
			},
			"response": []
		},
		{
			"name": "4. Test Case - Google OAuth Account",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"email\": \"googleuser@gmail.com\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseUrl}}/api/auth/forgot-password",
					"host": ["{{baseUrl}}"],
					"path": ["api", "auth", "forgot-password"]
				},
				"description": "Test case: User đăng ký bằng Google OAuth (không có password).\n\n**Expected:** Message \"This account uses Google authentication\""
			},
			"response": []
		},
		{
			"name": "5. Test Case - Token đã hết hạn",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"token\": \"expired-token-here\",\n  \"newPassword\": \"newpassword123\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseUrl}}/api/auth/reset-password",
					"host": ["{{baseUrl}}"],
					"path": ["api", "auth", "reset-password"]
				},
				"description": "Test case: Token đã hết hạn (> 1 giờ).\n\n**Expected:** Error \"Token has expired\""
			},
			"response": []
		},
		{
			"name": "6. Test Case - Mật khẩu quá ngắn",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"token\": \"{{reset_token}}\",\n  \"newPassword\": \"12345\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseUrl}}/api/auth/reset-password",
					"host": ["{{baseUrl}}"],
					"path": ["api", "auth", "reset-password"]
				},
				"description": "Test case: Mật khẩu mới < 6 ký tự.\n\n**Expected:** Error \"Password must be at least 6 characters long\""
			},
			"response": []
		}
	]
}

